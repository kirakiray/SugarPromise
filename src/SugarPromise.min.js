!function(t){function n(){this._eves={}}function e(t){var e=this,o=e._e=new n;e.state=i,e.args=t;var f=e._next=[];o.last(r,function(){var t=function(){o.emit(a),delete e.data,e._par&&e._par._e.emit(u),t=null};if(f.length){c(f,function(t){h(function(){t._init()})});var n=0;o.on(u,function(){n++,f.length==n&&(t(),o.off(u))})}else t()})}var i="wait",o="pending",r="fulfilled",f="rejected",u="wood",a="fire",s=function(t){return Array.prototype.slice.call(t,0)},c=function(){return[].forEach?function(t,n){return t.forEach(n)}:function(t,n){for(var e=0,i=t.length;i>e;e++)n(t[e],e)}}(),h=function(){var t=!1,n=[];return function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<n.length;e++)n[e]();n=[],t=!1},0)),n.push(e)}}();n.fn=n.prototype,n.prototype={_get:function(t){return this._eves[t]||(this._eves[t]={e:[],o:[]})},on:function(t,n){this._get(t).e.push(n)},one:function(t,n){this._get(t).o.push(n)},first:function(t,n){this._get(t).f=n},last:function(t,n){this._get(t).l=n},off:function(t){delete this._eves[t]},emit:function(t,n){var e=this._get(t),i=e.f;i&&i({name:t,type:"first"},n),delete e.f;for(var o=e.o;o.length;)o.shift()({name:t,type:"one"},n);c(e.e,function(e){e({name:t,type:"on"},n)});var r=e.l;r&&r({name:t,type:"last"},n),delete e.l}},e.prototype={_init:function(){var t=this,n=t._e,e=t.args;t.state=o;var i,u=e.length,a=[];if(!u)return t.state=r,void n.emit(r,{datas:a,state:r});var s=function(e,c,h){n.emit(o,{data:e,state:c,no:h}),u--,u||(i?n.emit(f,i):(t.state=r,n.emit(r,{datas:a,state:r})),s=i=a=null,n.off(o),n.off(f),n.off(r))};c(e,function(n,e){var o=!1;n.call(t,function(t){o||(a[e]=t,o=!0,s(t,r,e))},function(n){o||(t.state=f,i=i||[],i.push({no:e,data:n}),o=!0,s(n,f,e))})})},then:function(t){var n=this;return n._e.one(r,function(e,i){t.apply(n,i.datas)}),n},"catch":function(t){return this._e.one(f,function(n,e){t(e)}),this},pend:function(t){return this._e.on(o,function(n,e){t(e)}),this},prom:function(){var t=s(arguments),n=new e(t);return n._par=this,this._next.push(n),n},send:function(t){return this.data=t,this},gift:function(t){c(this._next,function(n){n.send(t)})},fire:function(t){return this._e.one(a,t),this}};var l=function(){var t=s(arguments),n=new e(t);return h(function(){n._init()}),n};t.prom=l,t.SimpleEvent=n,t.SugarPromise=e}(window);