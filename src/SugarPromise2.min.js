!function(n){function t(){this._eves={}}function e(){var n=this;n._e=new t,n._funs=[],n._fCou=0,n._id=0,n.datas=[],n.errs=[],n._r=0,n._next=[],n._nCou=0,n._h=0}var i="pending",o="fulfilled",u="rejected",r="fire",f=function(n){return Array.prototype.slice.call(n,0)},s=function(){return[].forEach?function(n,t){return n.forEach(t)}:function(n,t){for(var e=0,i=n.length;i>e;e++)t(n[e],e)}}(),c=function(){var n=!1,t=[];return function(e){n||(n=!0,setTimeout(function(){for(var e=0;e<t.length;e++)t[e]();t=[],n=!1},0)),t.push(e)}}();t.fn=t.prototype,t.prototype={_get:function(n){return this._eves[n]||(this._eves[n]={e:[],o:[]})},on:function(n,t){this._get(n).e.push(t)},one:function(n,t){this._get(n).o.push(t)},first:function(n,t){this._get(n).f=t},last:function(n,t){this._get(n).l=t},off:function(n){delete this._eves[n]},emit:function(n,t){var e=this._get(n),i=e.f;i&&i({name:n,type:"first"},t),delete e.f;for(var o=e.o;o.length;)o.shift()({name:n,type:"one"},t);s(e.e,function(e){e({name:n,type:"on"},t)});var u=e.l;u&&u({name:n,type:"last"},t),delete e.l}},e.prototype={_run:function(){var n=this;n._r=1,n._e.last(o,function(){n._next.length?n._h||s(n._next,function(n){n._run()}):n._e.emit(r)}),0 in n._funs?s(n._funs,function(n){n()}):n._e.emit(o),n._run=n._funs=null},_cp:function(n,t,e){var r=this,f=r._e;f.emit(i,{data:n,state:t,no:e}),--r._fCou||(f.emit(0 in r.errs?u:o),f.off(i),f.off(u),f.off(o),r.errs=r.datas=null)},add:function(n){var t=this;t._fCou++;var e=t._id++,i=0,r=function(){n.call(t,function(n){i||(i=1,t.datas[e]=n,t._cp(n,o,e))},function(n){i||(i=1,t.errs.push({no:e,data:n}),t._cp(n,u,e))})};t._r?r():t._funs.push(r)},then:function(n){var t=this;return t._e.one(o,function(){n.apply(t,t.datas)}),t},"catch":function(n){var t=this.errs;return this._e.one(u,function(){n(t)}),this},pend:function(n){return this._e.on(i,function(t,e){n(e)}),this},prom:function(){var n=new e;s(f(arguments),function(t){n.add(t)});var t=this;return t._nCou++,t._next.push(n),n._e.last(r,function(){--t._nCou||(t._e.emit(r),t._e=t._next=null)}),n},send:function(n){return this.data=n,this},gift:function(n){s(this._next,function(t){t.send(n)})},fire:function(n){return this._e.one(r,n),this},lock:function(){this._h=1},unlock:function(){var n=this;n._h&&(n._h=0,n.datas||n._next&&s(n._next,function(n){n._run()}))}};var _=function(){var n=new e;return s(f(arguments),function(t){n.add(t)}),c(function(){n._run()}),n};n.prom=_,n.SimpleEvent=t,n.SugarPromise=e}(window);